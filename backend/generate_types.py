# main.py
from dbm.ndbm import library

from py2ts import generate_ts
from py2ts.data import TSInterface, ts_reference_str

from beets_flask.importer.states import (
    SerializedSessionState,
)
from beets_flask.server.routes.db_models.session import FolderStatusResponse
from beets_flask.server.routes.inbox import Folder
from beets_flask.server.routes.library.resources import (
    AlbumResponse,
    AlbumResponseExpanded,
    AlbumResponseMinimal,
    AlbumResponseMinimalExpanded,
    ItemResponse,
    ItemResponseMinimal,
)

prefix = """/*
 * This file is generated by ../backend/generate_types.py
 * Do not edit this file manually!
 */
"""

elements = []

# Session state
elements.append(SerializedSessionState)

# Folder
elements.append(Folder)


# ------------------------------ library routes ------------------------------ #

# Item responses
elements.append(ItemResponse)
elements.append(ItemResponseMinimal)

# Album responses
elements.append(AlbumResponse)
elements.append(AlbumResponseMinimal)
elements.append(AlbumResponseExpanded)
elements.append(AlbumResponseMinimalExpanded)

# ---------------------------------------------------------------------------- #

elements.append(FolderStatusResponse)


with open("../frontend/src/pythonTypes.ts", "w") as f:
    f.write(prefix)

    elements = [generate_ts(e) for e in elements]
    f.write(ts_reference_str(elements))

print("Typescript types generated successfully!")
